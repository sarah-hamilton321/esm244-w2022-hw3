---
title: "ESM 244 HW 3 Task 1: Principal Component Analysis"
author: "Sarah Hamilton"
date: "2/15/2022"
output:
  html_document:
    code_folding: hide
    theme: yeti
    toc: yes
    toc_depth: 5
    toc_float: yes
    collapsed: yes
    smooth_scroll: yes
editor_options:
  chunk_output_type: console
---

# Introduction

The following code performs a principal component analysis (PCA) on global climatic data to determine which variables explain the variance in global climate. The data was collected from Google Earth Engine and contains variables related to elevation, temperature, tree cover, rain, and other climate variables. After I ran a PCA, I made a biplot and screeplot of the results.

Data Citation: zander_venter. (2018). Environmental variables for world countries. Kaggle.com. https://www.kaggle.com/zanderventer/environmental-variables-for-world-countries

```{r setup, include=TRUE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

library(tidyverse)
library(here)

library(ggfortify)
library(palmerpenguins)
library(patchwork)

library(readxl)
library(gghighlight)
library(lubridate)
library(plotly)

library(janitor)
```

# Principal Component Analysis 

```{r}
#data wrangling
env <- read_csv(here("data","world_env_vars.csv")) %>%
  select(elevation:isothermality, 
         rain_mean_annual, 
         temp_max_warmestMonth, 
         temp_mean_annual, 
         temp_min_coldestMonth, 
         wind, 
         cloudiness) %>%
  drop_na()
```

```{r}
#running the PCA
env_pca <- env %>%
  select(elevation:cloudiness) %>%
  scale() %>%
  prcomp()

# food <- read_csv(here("data","usda_nutrients.csv")) %>%
#   select(FoodGroup, Descrip, Energy_kcal:Zinc_mg)
#   #group_by(FoodGroup)
# 
# food_pca <- food %>%
#   select(Energy_kcal:Zinc_mg) %>%
#   scale() %>%
#   prcomp()

#making the biplot
autoplot(env_pca,
         data = env,
         loadings = TRUE,
         colour = '#72c6d5',
         loadings.label = TRUE,
         loadings.colour = 'gray',
         loadings.label.colour = 'black',
         loadings.label.vjust = -0.75,
         loadings.label.hjust = 0.25) +
  theme_minimal() +
  labs(caption = str_wrap("Figure 1. Biplot of the PCA results. The axes PC1 and PC2 show the directions accounting for the most variance in the data.")) +
  theme(plot.caption = element_text(hjust = 0.5))

# autoplot(food_pca,
#          data = food,
#          loadings = TRUE,
#          #colour = 'Food Group',
#          loadings.label = TRUE,
#          loadings.colour = 'black',
#          loadings.label.colour = 'black',
#          loadings.label.vjust = -0.5) +
#   theme_minimal()

```

```{r}
#making the screeplot using package 
#screeplot(env_pca, type = 'barplot', colour = '#72c6d5')

#making screeplot by hand
sd_vec <- env_pca$sdev
var_vec <- sd_vec^2

pc_names <- colnames(env_pca$rotation)
pct_expl_df <- data.frame(v = var_vec,
                          pct_v = var_vec / sum(var_vec),
                          pc = fct_inorder(pc_names)) %>%
  mutate(pct_lbl = paste0(round(pct_v*100, 1), '%'))

ggplot(pct_expl_df, aes(x = pc, y = v)) +
  geom_col(color = "#72c6d5", fill = "#578f8e") +
  geom_text(aes(label = pct_lbl), vjust = 0, nudge_y = 0.02) +
  labs(x = "Principal Component", y = "Variance Explained") +
  theme_minimal() +
  labs(caption = str_wrap("Figure 2. Screeplot of the PCA results. The x axis shows the principal components and the y axis shows the percent vairance explained by each principal component.")) +
  theme(plot.caption = element_text(hjust = 0.5))
```

My biplot and screeplot indicate the following:

- The majority of the variance between the countries can be explained by the first two principal components.

- asdf

- asdf

